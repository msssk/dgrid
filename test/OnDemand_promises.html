<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Test OnDemandGrids with promise-based stores</title>
<link rel="stylesheet" href="../../dojo/resources/dojo.css">
<link rel="stylesheet" href="../css/skins/claro.css">
<style>
	.dgrid {
		height: 300px;
	}
</style>
</head>
<body class="claro">
<p>This test page tests stores that return promises from their query methods.</p>

<h2>Grid with a dstore/Store</h2>
<!--<div>-->
<!--<button onclick="grid.set('collection', grid.collection.filter({ name: 'foo' }))">Show only items named 'foo'</button>-->
<!--<button onclick="grid.set('collection', grid.collection.store || grid.collection)">Reset query</button>-->
<!--</div>-->
<div id="grid1"></div>

<h2>Grid with a dojo/store</h2>
<div id="grid2"></div>

<h2>Grid with a dojo/data store</h2>
<div id="grid3"></div>

<script src="../../dojo/dojo.js" data-dojo-config="async:true"></script>
<script>
require([
	"dojo/_base/declare",
	"dojo/_base/lang",
	"dojo/Deferred",
	"dojo/data/ItemFileReadStore",
	"dojo/store/DataStore",
	"dgrid/OnDemandGrid",
	"dgrid/test/data/createAsyncStore",
	"dojo/store/Memory",
	"dstore/legacy/StoreAdapter",
	"dstore/Observable",
	"./data/stateData"
], function(declare, lang, Deferred, ItemFileReadStore, DataStore, OnDemandGrid, createAsyncStore, LegacyMemory, StoreAdapter, Observable, stateData){
	var ifws, datastore, asyncstore, grid, grid2, i,
			names = ["sasquatch", "foo", "bar", "zaphod", "beeblebrox"];

	function createItems(){
		// generate data
		var items = [];
		for(i = 1; i <= 200; i++){
			items.push({
				id: i,
				name: names[i % 5]
			});
		}
		return items;
	}

	// Create a grid with an async dstore store.
	new OnDemandGrid({
		columns: { id: "id", name: "name" },
		collection: createAsyncStore({ data: createItems() })
	}, "grid1");

	// Create a grid with an async dojo store.
	var LegacyAsyncMemory = declare([LegacyMemory], {
		query: function(query, options){
			var results, def, timer;
			results = this.inherited(arguments);
			def = new Deferred(function(){
				clearTimeout(timer);
			});
			timer = setTimeout(function(){
				def.resolve(results);
			}, 200);
			return def.promise;
		}
	});

	var store = new StoreAdapter(new LegacyAsyncMemory({
		data: createItems()
	})), new Observable());

	new OnDemandGrid({
		columns: { id: "id", name: "name" },
		collection: store
	}, "grid2");

//	// Create a dojo data
//	var dataStore = new DataStore({
//		store: new ItemFileReadStore({
//			data: stateData
//		})
//	});
//	StoreAdapter.adapt(dataStore);
//	new OnDemandGrid({
//		columns: { name: "Name", abbreviation: "Abbreviation" },
//		collection: dataStore
//	}, "grid3");
});
</script>
</body>
</html>
