# dgrid 0.4 Migration Guide

dgrid 0.4 incorporates significant changes designed to make dgrid more reliable and easier to extend. Some changes 
require that you modify how you are using dgrid in your software project. Please read about all of the changes in
the [dgrid v0.4.0 release notes](https://github.com/SitePen/dgrid/releases/tag/v0.4.0). Then come back here for help with refactoring your code. 

This document discusses the following changes:

* dojo/store replaced with dstore
* dgrid 0.4 requries Dojo 1.8 and above
* Column plugins converted to mixins:
	* editor
	* selector
	* tree
* List#renderArray no longer supports stores

## dojo/store replaced with dstore

dgrid 0.4 no longer supports the Dojo store API but instead uses [dstore](https://github.com/SitePen/dstore), the 
next evolution of the Dojo store API. 

Don't worry if you have a Dojo store that can't be refactored. Use dstore's 
[StoreAdapter](https://github.com/SitePen/dstore/blob/master/docs/Adapters.md#storeadapter) to make your store
provide the dstore API.
```js
var dstoreStore = new StoreAdapter({objectStore: dojoStore});
```

dstore's `dstore/Store` API contains familiar methods for manipulating individual 
items like `get`, `put` and `remove`. It the querying API provided 
by [`dstore/Collection`](https://github.com/SitePen/dstore/blob/master/docs/Collection.md) where dstore differs 
significantly from the Dojo store API.

In dgrid 0.3 and earlier, `OnDemandList` and `OnDemandGrid` looks for the `store` property to contain 
a reference to a Dojo store object.
```js
require([
	'dojo/store/Memory', 'dgrid/OnDemandGrid'
]), function (Memory, OnDemandGrid) {
	var data = [ /* Populate data with items... */ ]; 
	
	// Create a store object.
	var store = new Memory({ data: data });
	
	// Create a grid referencing the store.
	var grid = new OnDemandGrid({
		store: store,
		columns: { /* Define columns... */ }
	}, 'grid');
	
	grid.startup();
}
```

If you want to filter the items that dgrid 0.3 and earlier retrieves from the store, you must set the `query` property.
```js
// Create a grid referencing the store.
var grid = new OnDemandGrid({
	store: store,
	query: { size: 'large'; } // Show the large items only.
	columns: { /* Define columns... */ },
}, 'grid');
```

In dgrid 0.4, the `store` and `query` proerties have been replaced with the `collection` property which is set
to an object implementing the `dstore/Collection` API. Since `dstore/Store` extends `dstore/Collection`, you may set 
a grid's `collection` property to a dstore store object.
```js
require([
	'dstore/Memory', 'dgrid/OnDemandGrid'
]), function (Memory, OnDemandGrid) {
	var data = [ /* Populate data with items... */ ]; 
	
	// Create a store object.
	var store = new Memory({ data: data });
	
	// Create a grid referencing the store.
	var grid = new OnDemandGrid({
		collection: store,
		columns: { /* Define columns... */ }
	}, 'grid');
	
	grid.startup();
}
```

When you want to limit the items retrieve from a store, first use dstore's `Collection` API to filter the items 
and then assign the resulting collection to the grid's `collection` property.
```js
// Create a grid referencing filtered items from the store.
var grid = new OnDemandGrid({
	collection: store.filter({ size: 'large' }); // Show only the large items.
	columns: { /* Define columns... */ },
}, 'grid');
```
Since each `Collection` method returns a new `Collection` object, the method calls may be chained.
```js
var collection = store.filter({ size: 'large' }).sort('price');
```
You can change a grid's store filter by reassigning the `collection` property. Here is an
example of displaying items in a grid based on the items' sizes when buttons are clicked.
```js
on(smallButtonNode, 'click', function() {
	// When the "small" button is clicked, display only the small items.
	grid.set('collection', store.filter({ size: 'small' });
});
on(mediumButtonNode, 'click', function() {
	// When the "medium" button is clicked, display only the medium items.
	grid.set('collection', store.filter({ size: 'medium' });
});
on(largeButtonNode, 'click', function() {
	// When the "large" button is clicked, display only the large items.
	grid.set('collection', store.filter({ size: 'large' });
});
```
## dgrid 0.4 requries Dojo 1.8 and above

dstore requires Dojo 1.8 and newer so dgrid 0.4 no longer supports any version of Dojo older than 1.8.

## Column plugins converted to mixins

In dgrid 0.3 and earlier, the column plugins are functions that decorate column definition objects. In dgrid 0.4, the 
plugins were converted to class mixins to make them easier to extend and easier to use. 
 
Refer to the appopriate sections below that correspond to the plugins you are using.

### Editor plugin
With dgrid 0.3 and earlier, the editor plugin is used to add an input field to one or more grid columns.
```js
require([
	'dgrid/OnDemandGrid', 'dgrid/editor'
]), function (OnDemandGrid, editor) {
	var grid = new OnDemandGrid({
		store: store,
		columns: [
			/* Pass all editor properties in the column definition parameter. */
			editor( {
				field: 'firstName',
				label: 'First',
				editor: 'text',
				editOn: 'click'
			}),
			/* Pass the editor properties as additional parameters. */
			editor( {
				field: 'lastName',
				label: 'Last'
			}, 'text', 'click'),
			{
				field: 'age',
				label: 'Age'
			}
		]
	}, 'grid');
}
```
With dgrid 0.4, combine the `Editor` mixin with one of the grid classes.
```js
require([
	'dojo/_base/declare', 'dgrid/OnDemandGrid', 'dgrid/Editor'
]), function (declare, Memory, OnDemandGrid) {
	// Create a custom grid by mixing Editor with OnDemandGrid
	var grid = new (declare([OnDemandGrid, Editor]))({
		collection: store,
		columns: [
			{
				field: 'firstName',
				label: 'First',
				editor: 'text',
				editOn: 'click'
			},
			{
				field: 'lastName',
				label: 'Last',
				editor: 'text',
				editOn: 'click'
			),
			{
				field: 'age',
				label: 'Age'
			}
		]
	}, 'grid');
}
```
The `Editor` mixin looks for an `editor` property in each column definition to determine whether or not the
column should contain input fields.

Refer to the `Editor` mixin [documentation](https://github.com/SitePen/dgrid/blob/master/doc/components/mixins/Editor.md)
for more information.

### Selector plugin
With dgrid 0.3 and earlier, the selector plugin is used in conjunction with the Selection mixin
to add a selector component to a grid column. Clicking the selector component selects or deselects the entire row.
```js
require([
	'dojo/_base/declare', 'dgrid/OnDemandGrid', 'dgrid/Selection', 'dgrid/selector'
], function(declare, OnDemandGrid, Selection, selector){
	var grid = new (declare([OnDemandGrid, Selection]))({
		store: store,
		selectionMode: 'single',
		columns: {
			col1: selector({ label: 'Select', selectorType: 'radio' }),
			col2: 'Column 2'
		}
	}, 'grid');
});
```
With dgrid 0.4, combine the `Selector` mixin with one of the grid classes and add a `selector` property
to the column definition that should contain the selector component.
```js
require([
	'dojo/_base/declare', 'dgrid/OnDemandGrid', 'dgrid/Selection', 'dgrid/Selector'
], function(declare, OnDemandGrid, Selection, selector){
	var grid = new (declare([OnDemandGrid, Selection, Selector]))({
		store: store,
		selectionMode: 'single',
		columns: {
			col1: { label: 'Select', selector: 'radio' }),
			col2: 'Column 2'
		}
	}, 'grid');
});
```
Notice the `selector` property indicates the type of selector component. That replaces the old
`selectorType` property.

Refer to the `Selector` [documentation](https://github.com/SitePen/dgrid/blob/master/doc/components/mixins/Selector.md)
for more information.
 
### Tree plugin
With dgrid 0.3 and earlier, the tree plugin is used in conjunction with a store
to allow rows to expand to display child rows. 
```js
require([
	"dgrid/OnDemandGrid", "dgrid/tree" 
], function(OnDemandGrid, tree){
	var treeGrid = new OnDemandGrid({
		store: treeStore,
		columns: [
			tree({ label: "Name", field: "name" }),
			{ label:"Population", field: "population" },
			{ label:"Timezone", field: "timezone" }
		]
	}, "treeGrid");
});
```
With dgrid 0.4, combine the `Tree` mixin with `OnDemandGrid`.

```js
require([
	"dojo/_base/declare", "dgrid/OnDemandGrid", "dgrid/Tree"
], function(declare, OnDemandGrid, Tree){
	var treeGrid = new (declare([OnDemandGrid, Tree]))({
		collection: treeStore.fetch({ parent: null }),
		columns: [
			{ label: "Name", field: "name", renderExpando: true },
			{ label:"Population", field: "population" },
			{ label:"Timezone", field: "timezone" }
		]
	}, "treeGrid");
});
```
The `Tree` mixin will render the expando icon in the first column that contains the `renderExpando` property. The
value of `renderExpando` can also be a function that renders a custom expando icon or widget.

Refer to the `Tree` mixin [documentation](https://github.com/SitePen/dgrid/blob/master/doc/components/mixins/Tree.md)
for more information.

## List#renderArray no longer supports stores

With dgrid 0.3 and earlier, you can call `store.query()` and pass the results to `List#renderArray` which will 
render all of the items returned by the store. In order to make `List` more lightweight in dgrid 0.4, 
`List#renderArray` will now only accept arrays of objects. 

If you want a list or grid that will display all of the items in a store without paging and without the full 
implementation of `OnDemandList`, take a look at the tutorial [Rendering All Store Data at Once](http://dev/dgrid-website/dgrid/tutorials/single_query/). That 
tutorial demonstrates how to extend 'dgrid/_StoreMixin' to create a lightweight mixin that fetches all items from a store
when a list or grid is refreshed.



